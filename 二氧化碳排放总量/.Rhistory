tmp=rbind(con1,con2)
ph=ggplot(data=tmp)+
geom_point(aes(x=x,y=y,color=con))+
geom_line(aes(x=x,y=y,color=con))+
labs(x="",y="",color="国家")+
scale_color_manual(values=c("red","blue"))+
theme_bw()+
theme(panel.grid=element_blank(),
axis.text=element_text(size=10),
legend.position="top")+
facet_wrap(~fill,ncol=3,scales="free_y")
print(ph)
}
pfun2(pc1,pg1,tot1,"CHN","USA")
pfun2=function(pc,pg,tot,country1,country2){
options(warn=-1)
tmp1=pc[pc$Country.code==country1,]
tmp2=pg[pg$Country.code==country1,]
tmp3=tot[tot$Country.code==country1,]
con1=data.frame(x=rep(1990:2008,3),y=c(as.numeric(tmp1[1,3:21]),as.numeric(tmp2[1,3:21]),as.numeric(tmp3[1,3:21])),fill=rep(c("每GDP二氧化碳排放量","人均二氧化碳排放量","二氧化碳排放总量"),each=19),con=country1)
tmp1=pc[pc$Country.code==country2,]
tmp2=pg[pg$Country.code==country2,]
tmp3=tot[tot$Country.code==country2,]
con2=data.frame(x=rep(1990:2008,3),y=c(as.numeric(tmp1[1,3:21]),as.numeric(tmp2[1,3:21]),as.numeric(tmp3[1,3:21])),fill=rep(c("每GDP二氧化碳排放量","人均二氧化碳排放量","二氧化碳排放总量"),each=19),con=country2)
tmp=rbind(con1,con2)
ph=ggplot(data=tmp)+
geom_point(aes(x=x,y=y,color=con))+
geom_line(aes(x=x,y=y,color=con))+
labs(x="",y="",color="国家")+
scale_color_manual(values=c("red","blue"))+
theme_bw()+
theme(panel.grid=element_blank(),
axis.text=element_text(size=10),
legend.position="top",
legend.title=element_text(size=20),
legend.text=element_text(size=10))+
facet_wrap(~fill,ncol=3,scales="free_y")
print(ph)
}
pfun2(pc1,pg1,tot1,"CHN","USA")
pdf("中美二氧化碳.pdf",width=7,height=5)
pfun2(pc1,pg1,tot1,"CHN","USA")
dev.off()
pfun2=function(pc,pg,tot,country1,country2){
options(warn=-1)
tmp1=pc[pc$Country.code==country1,]
tmp2=pg[pg$Country.code==country1,]
tmp3=tot[tot$Country.code==country1,]
con1=data.frame(x=rep(1990:2008,3),y=c(as.numeric(tmp1[1,3:21]),as.numeric(tmp2[1,3:21]),as.numeric(tmp3[1,3:21])),fill=rep(c("每GDP二氧化碳排放量","人均二氧化碳排放量","二氧化碳排放总量"),each=19),con=country1)
tmp1=pc[pc$Country.code==country2,]
tmp2=pg[pg$Country.code==country2,]
tmp3=tot[tot$Country.code==country2,]
con2=data.frame(x=rep(1990:2008,3),y=c(as.numeric(tmp1[1,3:21]),as.numeric(tmp2[1,3:21]),as.numeric(tmp3[1,3:21])),fill=rep(c("每GDP二氧化碳排放量","人均二氧化碳排放量","二氧化碳排放总量"),each=19),con=country2)
tmp=rbind(con1,con2)
ph=ggplot(data=tmp)+
geom_point(aes(x=x,y=y,color=con))+
geom_line(aes(x=x,y=y,color=con))+
labs(x="",y="",color="国家")+
scale_color_manual(values=c("red","blue"))+
theme_bw()+
theme(panel.grid=element_blank(),
axis.text=element_text(size=10),
legend.position="top",
legend.title=element_text(size=15),
legend.text=element_text(size=10))+
facet_wrap(~fill,ncol=3,scales="free_y")
print(ph)
}
pdf("中美二氧化碳.pdf",width=7,height=5)
pfun2(pc1,pg1,tot1,"CHN","USA")
dev.off()
pfun2(pc1,pg1,tot1,"CHN","NA")
pfun2(pc1,pg1,tot1,"CHN","CHN")
name_con=unique(tot1$Country.code)
name_con=as.character(unique(tot1$Country.code))
shinyApp(
ui=fluidPage(
titlePanel("两国比较"),
selectInput("con1","国家一",name_con),
selectInput("con2","国家二",name_con),
plotOutput("plot")
),
server=function(input,output){
output$plot=renderPlot(pfun2(pc1,pg1,tot1,input$con1,input$con2))
}
)
shinyApp(
ui=fluidPage(
titlePanel("两国比较"),
selectInput("con1","国家一",name_con),
selectInput("con2","国家二",name_con),
plotOutput("plot",height=500,width=700)
),
server=function(input,output){
output$plot=renderPlot(pfun2(pc1,pg1,tot1,input$con1,input$con2))
}
)
library(shiny)
library(ggplot2)
library(showtext)
library(scales)
library("latex2exp")
library(plyr)
library(grid)
library(grDevices)
showtext.auto(enable=T)
setwd("~/Documents/作业/数据可视化作业/第三次作业")
pc1=read.csv('pc1.csv',header=T,sep=',')
pg1=read.csv('pg1.csv',header=T,sep=',')
tot1=read.csv('tot1.csv',header=T,sep=',')
pc1=pc1[,-22][!is.na(pc1$Region),]
pg1=pg1[,-22][!is.na(pg1$Region),]
tot1=tot1[,-22][!is.na(tot1$Region),]
pfun2=function(pc,pg,tot,country1,country2){
options(warn=-1)
tmp1=pc[pc$Country.code==country1,]
tmp2=pg[pg$Country.code==country1,]
tmp3=tot[tot$Country.code==country1,]
con1=data.frame(x=rep(1990:2008,3),y=c(as.numeric(tmp1[1,3:21]),as.numeric(tmp2[1,3:21]),as.numeric(tmp3[1,3:21])),fill=rep(c("每GDP二氧化碳排放量","人均二氧化碳排放量","二氧化碳排放总量"),each=19),con=country1)
tmp1=pc[pc$Country.code==country2,]
tmp2=pg[pg$Country.code==country2,]
tmp3=tot[tot$Country.code==country2,]
con2=data.frame(x=rep(1990:2008,3),y=c(as.numeric(tmp1[1,3:21]),as.numeric(tmp2[1,3:21]),as.numeric(tmp3[1,3:21])),fill=rep(c("每GDP二氧化碳排放量","人均二氧化碳排放量","二氧化碳排放总量"),each=19),con=country2)
tmp=rbind(con1,con2)
ph=ggplot(data=tmp)+
geom_point(aes(x=x,y=y,color=con))+
geom_line(aes(x=x,y=y,color=con))+
labs(x="",y="",color="国家")+
scale_color_manual(values=c("red","blue"))+
theme_bw()+
theme(panel.grid=element_blank(),
axis.text=element_text(size=10),
legend.position="top",
legend.title=element_text(size=15),
legend.text=element_text(size=10))+
facet_wrap(~fill,ncol=3,scales="free_y")
print(ph)
}
name_con=as.character(unique(tot1$Country.code))
shinyApp(
ui=fluidPage(
titlePanel("两国比较"),
selectInput("con1","国家一",name_con),
selectInput("con2","国家二",name_con),
plotOutput("plot",height=500,width=700)
),
server=function(input,output){
output$plot=renderPlot(pfun2(pc1,pg1,tot1,input$con1,input$con2))
}
)
library(shiny)
library(ggplot2)
library(showtext)
library(scales)
library("latex2exp")
library(plyr)
library(grid)
library(grDevices)
showtext.auto(enable=T)
require(rWBclimate)
setwd("~/Documents/作业/数据可视化作业/第三次作业")
options(kmlpath = "~/Documents/作业/数据可视化作业/第三次作业/kmltmp")
world <- c(NoAm_country, SoAm_country, Eur_country, Asia_country, Africa_country,Oceana_country)
world_basin <- create_map_df(world)
pc=read.csv("pc.csv",header=T,sep=",")
pg=read.csv("pg.csv",header=T,sep=",")
tot=read.csv("tot.csv",header=T,sep=",")
pc$ID=pc$Country.code
pg$ID=pg$Country.code
tot$ID=tot$Country.code
pc=pc[pc$Country.code%in%world_basin$ID,]
pg=pg[pg$Country.code%in%world_basin$ID,]
tot=tot[tot$Country.code%in%world_basin$ID,]
pcb=join(world_basin,pc,by='ID')
pgb=join(world_basin,pg,by='ID')
totb=join(world_basin,tot,by='ID')
pfun2=function(data1,data2,year){
yr=paste("X",year,sep="")
tmp=data1[,c(1:8)]
tmp$fill=data1[,yr]
ph1=ggplot(tmp,aes(x=long, y=lat,group=group,fill=fill))+
scale_fill_gradient(high=muted("red"),
low="gray")+
geom_polygon()+
theme_classic()+
theme(legend.title=element_blank(),
legend.position=c(0.55,0.1),
legend.text=element_text(size=10,angle=20,vjust=-3),
legend.direction="horizontal",
axis.title=element_blank(),
axis.text=element_blank(),
axis.ticks=element_blank(),
axis.line=element_blank())
tmp2=data2[order(data2[,yr],decreasing=T)[1:20],]
tmp2$ID=factor(tmp2$ID,levels=tmp2$ID)
ph2=ggplot(tmp2,aes(x=ID,y=tmp2[,yr],fill=tmp2[,yr]))+
geom_bar(stat="identity")+
scale_fill_gradient(high=muted("red"),
low="gray")+
coord_flip()+
theme_classic()+
theme(legend.position="None",
axis.title=element_blank(),
axis.text=element_text(size=10))
grid.newpage()
pushViewport(viewport(layout = grid.layout(1,10)))
vplayout <- function(x,y){
viewport(layout.pos.row = x, layout.pos.col = y)
}
print(ph1, vp = vplayout(1,1:7))
print(ph2, vp = vplayout(1,8:10))
}
pdf("2008每GDP二氧化碳排放量地图2.pdf",width=7,height=5)
dev.off()
pdf("2008每GDP二氧化碳排放量地图2.pdf",width=7,height=5)
pfun2(pgb,pg,2008)
dev.off()
pfun3=function(data1,data2,year){
yr=paste("X",year,sep="")
tmp1=data1[,c(1:8)]
tmp1$fill=data1[,yr]
ph1=ggplot(tmp1,aes(x=long, y=lat,group=group,fill=fill))+
scale_fill_gradient2(midpoint=median(tot$X2008,na.rm=T),
high=muted("red"),
mid="gray",
low="blue",
breaks=c(0,2e6,4e6,6e6),
labels=c(TeX("$ \\0.0 \\times 10^{6}$"),
TeX("$ \\2.0 \\times 10^{6}$"),
TeX("$ \\4.0 \\times 10^{6}$"),
TeX("$ \\6.0 \\times 10^{6}$")))+
geom_polygon()+
theme_classic()+
theme(legend.title=element_blank(),
legend.position=c(0.55,0.1),
legend.text=element_text(size=10,angle=20,vjust=-3),
legend.direction="horizontal",
axis.title=element_blank(),
axis.text=element_blank(),
axis.ticks=element_blank(),
axis.line=element_blank())
data2=data.frame(ID=data2[,22],y=data2[,yr])
tmp2=data2[order(data2$y,decreasing=T)[1:10],]
tmp2$ID=factor(tmp2$ID,levels=tmp2$ID)
ph2=ggplot(tmp2,aes(x=ID,y=y,fill=y))+
geom_bar(stat="identity")+
scale_fill_gradient(high=muted("red"),
low="gray")+
scale_y_continuous(breaks=c(0,2e6,4e6,6e6),
labels=c(TeX("$ \\0.0 \\times 10^{6}$"),
TeX("$ \\2.0 \\times 10^{6}$"),
TeX("$ \\4.0 \\times 10^{6}$"),
TeX("$ \\6.0 \\times 10^{6}$")))+
theme_classic()+
theme(legend.position="None",
axis.title=element_blank(),
axis.text.x=element_text(size=10,angle=45,
vjust=1,hjust=0.9),
axis.text.y=element_text(size=10,angle=30,vjust=-0.1))
tmp3=rbind(tmp2[1:5,],data.frame(ID="其他",y=sum(data2$y[!data2$ID%in%tmp2$ID[1:5]],na.rm=T)))
tmp3$ID=factor(tmp3$ID,levels=tmp3$ID[6:1])
tmp3$y2=(c(0,cumsum(tmp3$y)[-6])+cumsum(tmp3$y))/2
tmp3$y3=paste(round(tmp3$y/sum(tmp3$y)*100,0),"%",sep="")
ph3=ggplot(tmp3)+
geom_bar(aes(x=factor(1),y=y,fill=ID),
stat="identity",position="stack",width=0.7)+
geom_text(aes(x=factor(1),y=y2,label=ID),
size=3.5,nudge_x=0.5)+
geom_text(aes(x=factor(1),y=y2,label=y3),
size=3,nudge_x=0.25)+
scale_fill_brewer(palette="Reds")+
coord_polar(theta="y")+
theme_classic()+
theme(legend.position="None",
axis.title=element_blank(),
axis.text=element_blank(),
axis.ticks=element_blank(),
axis.line=element_blank())
grid.newpage()
pushViewport(viewport(layout = grid.layout(2,10)))
vplayout <- function(x,y){
viewport(layout.pos.row = x, layout.pos.col=y)
}
print(ph1, vp = vplayout(1:2,1:6))
print(ph3, vp = vplayout(1,7:10))
print(ph2, vp = vplayout(2,7:10))
}
shinyApp(
ui=fluidPage(
titlePanel("二氧化碳排放总量地图"),
sliderInput("year","年份",
min=1990,max=2008,value=19),
plotOutput("plot",height=500,width=900)
),
server=function(input,output){
output$plot=renderPlot(pfun3(totb,tot,input$year))
}
)
library(shiny)
library(ggplot2)
library(showtext)
library(scales)
library("latex2exp")
library(plyr)
library(grid)
library(grDevices)
showtext.auto(enable=T)
setwd("~/Documents/作业/数据可视化作业/第三次作业")
pc1=read.csv('pc1.csv',header=T,sep=',')
pg1=read.csv('pg1.csv',header=T,sep=',')
tot1=read.csv('tot1.csv',header=T,sep=',')
pc1=pc1[,-22][!is.na(pc1$Region),]
pg1=pg1[,-22][!is.na(pg1$Region),]
tot1=tot1[,-22][!is.na(tot1$Region),]
pfun1=function(pc,pg,tot,year){
options(warn=-1)
yr=paste("X",year,sep="")
tmp1=data.frame(ID=pc$Country.code,x=pc[,yr])
tmp2=data.frame(ID=pg$Country.code,y=pg[,yr])
tmp3=data.frame(ID=tot$Country.code,size=tot[,yr])
tmp=join(tmp1,tmp2,by="ID")
tmp=join(tmp,tmp3,by="ID")
ph=ggplot(data=tmp)+
geom_point(aes(x=x,y=y,size=size),color="red",alpha=0.6)+
labs(x="人均二氧化碳排放量",y="每GDP二氧化碳排放量",size="排放总量")+
geom_hline(aes(yintercept=median(y,na.rm=T)),
linetype=2,color="darkred",size=1)+
geom_vline(aes(xintercept=median(x,na.rm=T)),
linetype=2,color="darkred",size=1)+
annotate("text",
x=30,
y=median(tmp$y,na.rm=T),
label=paste("中位数",round(median(tmp$y,na.rm=T),1)),
hjust=1,vjust=1.5,size=5)+
annotate("text",
y=1500,
x=median(tmp$x,na.rm=T),
label=paste("中位数",round(median(tmp$x,na.rm=T),1)),
hjust=0,vjust=1.5,size=5)+
geom_text(data=tmp[order(tmp$size,decreasing=T)[1:5],],
aes(x=x,y=y,label=ID),size=4,vjust=-1)+
scale_size_continuous(range=c(1,10),
breaks=c(2e6,4e6,6e6),
labels=c(TeX("$ \\2.0 \\times 10^{6}$"),
TeX("$ \\4.0 \\times 10^{6}$"),
TeX("$ \\6.0 \\times 10^{6}$")))+
scale_x_continuous(limits=c(0,30))+
scale_y_continuous(limits=c(0,1500))+
theme_classic()+
theme(axis.title=element_text(size=18),
axis.text=element_text(size=10),
legend.text=element_text(size=10),
legend.title=element_text(size=18))
print(ph)
}
pfun2=function(pc,pg,tot,country1,country2){
options(warn=-1)
tmp1=pc[pc$Country.code==country1,]
tmp2=pg[pg$Country.code==country1,]
tmp3=tot[tot$Country.code==country1,]
con1=data.frame(x=rep(1990:2008,3),y=c(as.numeric(tmp1[1,3:21]),as.numeric(tmp2[1,3:21]),as.numeric(tmp3[1,3:21])),fill=rep(c("每GDP二氧化碳排放量","人均二氧化碳排放量","二氧化碳排放总量"),each=19),con=country1)
tmp1=pc[pc$Country.code==country2,]
tmp2=pg[pg$Country.code==country2,]
tmp3=tot[tot$Country.code==country2,]
con2=data.frame(x=rep(1990:2008,3),y=c(as.numeric(tmp1[1,3:21]),as.numeric(tmp2[1,3:21]),as.numeric(tmp3[1,3:21])),fill=rep(c("每GDP二氧化碳排放量","人均二氧化碳排放量","二氧化碳排放总量"),each=19),con=country2)
tmp=rbind(con1,con2)
ph=ggplot(data=tmp)+
geom_point(aes(x=x,y=y,color=con))+
geom_line(aes(x=x,y=y,color=con))+
labs(x="",y="",color="国家")+
scale_color_manual(values=c("red","blue"))+
theme_bw()+
theme(panel.grid=element_blank(),
axis.text=element_text(size=10),
legend.position="top",
legend.title=element_text(size=15),
legend.text=element_text(size=10))+
facet_wrap(~fill,ncol=3,scales="free_y")
print(ph)
}
pfun2=function(pc,pg,tot,country1,country2){
options(warn=-1)
tmp1=pc[pc$Country.code==country1,]
tmp2=pg[pg$Country.code==country1,]
tmp3=tot[tot$Country.code==country1,]
con1=data.frame(x=rep(1990:2008,3),y=c(as.numeric(tmp1[1,3:21]),as.numeric(tmp2[1,3:21]),as.numeric(tmp3[1,3:21])),fill=rep(c("每GDP二氧化碳排放量","人均二氧化碳排放量","二氧化碳排放总量"),each=19),con=country1)
tmp1=pc[pc$Country.code==country2,]
tmp2=pg[pg$Country.code==country2,]
tmp3=tot[tot$Country.code==country2,]
con2=data.frame(x=rep(1990:2008,3),y=c(as.numeric(tmp1[1,3:21]),as.numeric(tmp2[1,3:21]),as.numeric(tmp3[1,3:21])),fill=rep(c("每GDP二氧化碳排放量","人均二氧化碳排放量","二氧化碳排放总量"),each=19),con=country2)
tmp=rbind(con1,con2)
ph=ggplot(data=tmp)+
geom_point(aes(x=x,y=y,color=con))+
geom_line(aes(x=x,y=y,color=con))+
labs(x="",y="",color="国家")+
scale_color_manual(values=c("red","blue"))+
theme_bw()+
theme(panel.grid=element_blank(),
axis.text=element_text(size=10),
legend.position="top",
legend.title=element_text(size=15),
legend.text=element_text(size=10))+
facet_wrap(~fill,ncol=1,scales="free_y")
print(ph)
}
shinyApp(
ui=fluidPage(
titlePanel("两国比较"),
selectInput("con1","国家一",name_con),
selectInput("con2","国家二",name_con),
plotOutput("plot",height=500,width=700)
),
server=function(input,output){
output$plot=renderPlot(pfun2(pc1,pg1,tot1,input$con1,input$con2))
}
)
name_con=as.character(unique(tot1$Country.code))
shinyApp(
ui=fluidPage(
titlePanel("两国比较"),
selectInput("con1","国家一",name_con),
selectInput("con2","国家二",name_con),
plotOutput("plot",height=500,width=700)
),
server=function(input,output){
output$plot=renderPlot(pfun2(pc1,pg1,tot1,input$con1,input$con2))
}
)
pdf("中美二氧化碳.pdf",width=7,height=5)
pfun2(pc1,pg1,tot1,"CHN","USA")
dev.off()
shinyApp(
ui=fluidPage(
titlePanel("气泡图"),
sliderInput("year","年份",
min=1990,max=2008,value=19),
plotOutput("plot",height=500,width=700)
),
server=function(input,output){
output$plot=renderPlot(pfun1(pc1,pg1,tot1,input$year))
}
)
setwd("~/Documents/作业/数据可视化作业/第三次作业/shinyapp/气泡图")
save(pc1,file="pc1.rda")
save(pg1,file="pg1.rda")
save(tot1,file="tot1.rda")
runApp("~/shinyApp")
setwd("~/Documents/作业/数据可视化作业/第三次作业/shinyapp/")
runApp("~/气泡图")
runApp("~/Documents/作业/数据可视化作业/第三次作业/shinyapp/气泡图")
shinyApp(
ui=fluidPage(
titlePanel("气泡图"),
sliderInput("year","年份",
min=1990,max=2008,value=19),
plotOutput("plot",height=500,width=700)
),
server=function(input,output){
output$plot=renderPlot(pfun1(pc1,pg1,tot1,input$year))
}
)
runApp("~/Documents/作业/数据可视化作业/第三次作业/shinyapp/气泡图")
runApp("~/Documents/作业/数据可视化作业/第三次作业/shinyapp/气泡图")
load("pc1.rda")
runApp("~/Documents/作业/数据可视化作业/第三次作业/shinyapp/气泡图")
runApp("~/Documents/作业/数据可视化作业/第三次作业/shinyapp/气泡图")
runApp("~/Documents/作业/数据可视化作业/第三次作业/shinyapp/气泡图")
setwd("~/Documents/作业/数据可视化作业/第三次作业/shinyapp/折线图")
save(name_con,file="name_con.rda")
runApp("~/Documents/作业/数据可视化作业/第三次作业/shinyapp/折线图")
library(shiny)
library(ggplot2)
library(showtext)
library(scales)
library("latex2exp")
library(plyr)
library(grid)
library(grDevices)
showtext.auto(enable=T)
require(rWBclimate)
setwd("~/Documents/作业/数据可视化作业/第三次作业")
options(kmlpath = "~/Documents/作业/数据可视化作业/第三次作业/kmltmp")
world <- c(NoAm_country, SoAm_country, Eur_country, Asia_country, Africa_country,Oceana_country)
world_basin <- create_map_df(world)
pc=read.csv("pc.csv",header=T,sep=",")
pg=read.csv("pg.csv",header=T,sep=",")
tot=read.csv("tot.csv",header=T,sep=",")
pc$ID=pc$Country.code
pg$ID=pg$Country.code
tot$ID=tot$Country.code
pc=pc[pc$Country.code%in%world_basin$ID,]
pg=pg[pg$Country.code%in%world_basin$ID,]
tot=tot[tot$Country.code%in%world_basin$ID,]
pcb=join(world_basin,pc,by='ID')
pgb=join(world_basin,pg,by='ID')
totb=join(world_basin,tot,by='ID')
setwd("~/Documents/作业/数据可视化作业/第三次作业/shinyapp/人均二氧化碳排放量")
save(pcb,file="pcb.rda")
save(pc,file="pc.rda")
shinyApp("~/Documents/作业/数据可视化作业/第三次作业/shinyapp/人均二氧化碳排放量")
shinyApp("~/Documents/作业/数据可视化作业/第三次作业/shinyapp/人均二氧化碳排放量")
shinyApp("~/Documents/作业/数据可视化作业/第三次作业/shinyapp/人均二氧化碳排放量")
runApp("~/Documents/作业/数据可视化作业/第三次作业/shinyapp/折线图")
runApp("~/Documents/作业/数据可视化作业/第三次作业/shinyapp/人均二氧化碳排放量")
setwd("~/Documents/作业/数据可视化作业/第三次作业/shinyapp/每GDP二氧化碳排放量")
save(pg,file="pg.rda")
save(pgb,file="pgb.rda")
runApp("~/Documents/作业/数据可视化作业/第三次作业/shinyapp/每GDP二氧化碳排放量")
setwd("~/Documents/作业/数据可视化作业/第三次作业/shinyapp/二氧化碳排放总量")
save(totb,file="totb.rda")
save(tot,file="tot.rda")
runApp("~/Documents/作业/数据可视化作业/第三次作业/shinyapp/二氧化碳排放总量")
